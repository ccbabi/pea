/*!
 * pea-js 0.2.1
 * Pea is a middleware layer for web, inspired by the connect
 * Copyright 2017, ccbabi <kxxw28@gmail.com>
 * Released under the MIT license.
*/

!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.Pea=n()}(this,function(){"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t){var n=r.toString.call(t).match(/\((\w+)/);return!!n&&a.indexOf(n[1])>-1}var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),i=Array.prototype,r=Function.prototype,a=["e","err","error"];return function(){function r(n){var e=this;t(this,r),this.stack=[],this.head=0,this.tail=0,n&&n instanceof Array&&n.forEach(function(t){return e.use(t)})}return e(r,[{key:"use",value:function(t){var n=void 0;return n=t instanceof r?function(){var n=i.pop.apply(arguments);t.use(function(){i.pop.apply(arguments),n.apply(this,arguments)}),t.use(function(t,e){t&&n(t)}),t.start.apply(t,arguments)}.bind(this):t,this.tail=this.stack.push(n),this}},{key:"start",value:function(){this.head=0,this.next.apply(this,arguments)}},{key:"next",value:function(t){this.run.apply(this,arguments)}},{key:"run",value:function(){var t=void 0,e=void 0,r=i.slice.apply(arguments),a=r[0];if(a instanceof Error&&(e=a),this.head>=this.tail){if(e)throw e}else{for(;!e&&r.length&&void 0==a;)r.shift(),a=r[0];if(t=this.stack[this.head++],e&&n(t)||!e&&!n(t)){r.push(this.next.bind(this));try{return void t.apply(this,r)}catch(t){e=t}}this.next(e)}}}]),r}()});