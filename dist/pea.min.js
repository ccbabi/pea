/*!
 * pea 0.1.0
 * Pea is a middleware layer for web, inspired by the connect
 * Copyright 2017, ccbabi <kxxw28@gmail.com>
 * Released under the MIT license.
*/

!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.Pea=i()}(this,function(){"use strict";function t(t){var i=n.toString.call(t).match(/\((\w+)/);return!!i&&e.indexOf(i[1])>-1}var i=Array.prototype,n=Function.prototype,s=function(){},e=["e","err","error"];return function(){function n(t){void 0===t&&(t=[]);var i=this;this.done=s,this.stack=[],this.head=0,this.tail=0,this.one=!1,t.forEach(function(t){return i.use(t)})}return n.prototype.use=function(t){var s;return s=t instanceof n?function(){var n=i.slice.apply(arguments);n.unshift(n.pop()),t.start.apply(t,n)}:t,this.stack.push(s),this.tail=this.stack.length,this},n.prototype.start=function(t){if(!this.stack)throw Error("");t&&(this.done=i.shift.apply(arguments)),this.next.apply(this,arguments)},n.prototype.oneStart=function(){this.one=!0,this.start.apply(this,arguments)},n.prototype.destroy=function(){this.head=0,this.tail=0,this.stack.length=0},n.prototype.next=function(t){this.run.apply(this,arguments)},n.prototype.run=function(){var n,s,e,o=!1,r=i.slice.apply(arguments);if(this.head>=this.tail)return this.done&&this.done.apply(this,r),this.head=0,void(this.one&&this.destroy());if((e=r[0])instanceof Error)o=!0;else for(;r.length&&void 0==e;)r.shift(),e=r[0];if(n=this.stack[this.head++],r.push(this.next.bind(this)),o&&t(n)||!o&&!t(n))try{return void n.apply(this,r)}catch(t){s=t}this.next(s)},n}()});