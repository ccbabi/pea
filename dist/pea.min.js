/*!
 * pea-js 0.2.0
 * Pea is a middleware layer for web, inspired by the connect
 * Copyright 2017, ccbabi <kxxw28@gmail.com>
 * Released under the MIT license.
*/

!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.Pea=i()}(this,function(){"use strict";function t(t){var i=n.toString.call(t).match(/\((\w+)/);return!!i&&o.indexOf(i[1])>-1}var i=Array.prototype,n=Function.prototype,e=function(){},o=["e","err","error"];return function(){function n(t,i){var n=this;this.done=e,this.stack=[],this.head=0,this.tail=0,t&&t instanceof Array?t.forEach(function(t){return n.use(t)}):"function"==typeof t&&(this.done=t),"function"==typeof i&&(this.done=i)}return n.prototype.use=function(t){var e;if(t instanceof n){var o=this;e=function(){var n=i.slice.apply(arguments),e=n.pop(),s=t.done;n.unshift(function(){var t=i.slice.apply(arguments);!1!==s.apply(arguments)&&e.apply(o,t)}),t.start.apply(t,n)}}else e=t;return this.stack.push(e),this.tail=this.stack.length,this},n.prototype.start=function(t){if(!this.stack)throw Error("");t&&(this.done=i.shift.apply(arguments)),this.next.apply(this,arguments)},n.prototype.next=function(t){this.run.apply(this,arguments)},n.prototype.run=function(){var n,e,o,s=!1,r=i.slice.apply(arguments);if(this.head>=this.tail)return this.done&&this.done.apply(this,r),void(this.head=0);if((o=r[0])instanceof Error)s=!0;else for(;r.length&&void 0==o;)r.shift(),o=r[0];if(n=this.stack[this.head++],r.push(this.next.bind(this)),s&&t(n)||!s&&!t(n))try{return void n.apply(this,r)}catch(t){e=t}this.next(e)},n}()});