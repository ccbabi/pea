/*!
 * pea-js 0.2.0
 * Pea is a middleware layer for web, inspired by the connect
 * Copyright 2017, ccbabi <kxxw28@gmail.com>
 * Released under the MIT license.
*/

!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.Pea=n()}(this,function(){"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t){var n=o.toString.call(t).match(/\((\w+)/);return!!n&&a.indexOf(n[1])>-1}var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),i=Array.prototype,o=Function.prototype,r=function(){},a=["e","err","error"];return function(){function o(n,e){var i=this;t(this,o),this.done=r,this.stack=[],this.head=0,this.tail=0,n&&n instanceof Array?n.forEach(function(t){return i.use(t)}):"function"==typeof n&&(this.done=n),"function"==typeof e&&(this.done=e)}return e(o,[{key:"use",value:function(t){var n=void 0;if(t instanceof o){var e=this;n=function(){var n=i.slice.apply(arguments),o=n.pop(),r=t.done;n.unshift(function(){var n=void 0;try{n=r.apply(t,arguments)}catch(t){return void o(t)}!1!==n&&o.apply(e,arguments)}),t.start.apply(t,n)}}else n=t;return this.stack.push(n),this.tail=this.stack.length,this}},{key:"start",value:function(t){t&&(this.done=i.shift.apply(arguments)),this.head=0,this.next.apply(this,arguments)}},{key:"setDone",value:function(t){"function"==typeof t&&(this.done=t)}},{key:"next",value:function(t){this.run.apply(this,arguments)}},{key:"run",value:function(){var t=void 0,e=void 0,o=void 0,r=!1,a=i.slice.apply(arguments);if(this.head>=this.tail)this.done.apply(this,a);else{if((o=a[0])instanceof Error)r=!0;else for(;a.length&&void 0==o;)a.shift(),o=a[0];if(t=this.stack[this.head++],a.push(this.next.bind(this)),r&&n(t)||!r&&!n(t))try{return void t.apply(this,a)}catch(t){e=t}this.next(e)}}}]),o}()});